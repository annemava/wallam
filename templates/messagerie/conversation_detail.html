{% extends 'default.html' %}
{% load static %}
{% block title %} Wallam | Messagerie {% endblock %}
{% block menu %}
<ul class="nav navbar-nav">
    <li>
        <a href="{% url 'index' %}">Accueil</a>
    </li>
    <li>
        <a href="{% url 'create_campaign' %}">Créer une cagnotte</a>
    </li>
    <li><a href="{% url 'announce' %}">Créer une annonce</a></li>
</ul>
{% endblock %}
{% block content %}
<style>
.chat-container {
    max-width: 600px;
    margin: 32px auto 0 auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 16px rgba(51,156,144,0.10);
    padding: 0 0 18px 0;
}
.chat-header {
    background: #339c90;
    color: #fff;
    border-radius: 12px 12px 0 0;
    padding: 18px 24px;
    font-size: 1.25em;
    font-weight: 600;
    letter-spacing: 1px;
}
.chat-messages {
    max-height: 350px;
    overflow-y: auto;
    padding: 18px 24px 0 24px;
    background: #eaf7f5;
    border-radius: 0 0 0 0;
}
.message-row {
    display: flex;
    flex-direction: column;
    margin-bottom: 18px;
}
.message-me {
    align-items: flex-end;
}
.message-other {
    align-items: flex-start;
}
.message-bubble {
    max-width: 75%;
    padding: 10px 16px;
    border-radius: 16px;
    margin-bottom: 2px;
    font-size: 1.08em;
    word-break: break-word;
}
.message-me .message-bubble {
    background: #339c90;
    color: #fff;
    border-bottom-right-radius: 4px;
}
.message-other .message-bubble {
    background: #fff;
    color: #28786b;
    border: 1.5px solid #339c90;
    border-bottom-left-radius: 4px;
}
.message-meta {
    font-size: 0.85em;
    color: #888;
    margin-bottom: 6px;
}
.chat-form {
    display: flex;
    align-items: flex-end;
    gap: 10px;
    padding: 18px 24px 0 24px;
}
.chat-form textarea {
    flex: 1;
    border-radius: 8px;
    border: 1.5px solid #339c90;
    padding: 10px;
    font-size: 1em;
    resize: none;
    min-height: 48px;
    background: #f8fefd;
}
.chat-form button {
    background: #339c90;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 22px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
}
.chat-form button:hover {
    background: #28786b;
}
@media (max-width: 700px) {
    .chat-container { max-width: 98vw; }
    .chat-header, .chat-messages, .chat-form { padding-left: 8px; padding-right: 8px; }
}
</style>

<div class="chat-container">
    <div class="chat-header">
        Conversation avec 
        {% for p in conversation.participants.all %}
            {% if p.user.id != request.user.id %}
                {{ p.user.get_full_name|default:p.user.email }}
            {% endif %}
        {% endfor %}
    </div>
    <div class="chat-messages">
        {% for msg in messages %}
            <div class="message-row {% if msg.sender.user.id == request.user.id %}message-me{% else %}message-other{% endif %}">
                <div class="message-meta">
                    <b>
                        {% if msg.sender.user.id == request.user.id %}
                            Moi
                        {% else %}
                            {{ msg.sender.user.get_full_name|default:msg.sender.user.email }}
                        {% endif %}
                    </b>
                    <span style="font-size:0.85em; margin-left:8px;">{{ msg.created_at|date:"d/m/Y H:i" }}</span>
                </div>
                <div class="message-bubble">
                    {{ msg.content }}
                </div>
            </div>
        {% empty %}
            <div style="color:#888; text-align:center; margin-top:30px;">Aucun message pour le moment.</div>
        {% endfor %}
    </div>
    <form method="post" class="chat-form">
        {% csrf_token %}
        <textarea name="content" rows="2" placeholder="Votre message..." required></textarea>
        <button type="submit">Envoyer</button>
    </form>
</div>
{% endblock %}